{
  "info": {
    "name": "MatControl - Fluxo Professor (Robusto)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:5000" },
    { "key": "token", "value": "" },
    { "key": "emailProfessor", "value": "professor@example.com" },
    { "key": "senhaProfessor", "value": "senha123" },
    { "key": "codigoAcademia", "value": "" },
    { "key": "turmaId", "value": "" },
    { "key": "aulaId", "value": "" },
    { "key": "timezone", "value": "America/Sao_Paulo" }
  ],
  "item": [
    {
      "name": "Autenticação",
      "item": [
        {
          "name": "Registrar Professor",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/api/auth/registrar-professor" },
            "body": { "mode": "raw", "raw": "{\n  \"nome\": \"Professor Exemplo\",\n  \"email\": \"{{emailProfessor}}\",\n  \"senha\": \"{{senhaProfessor}}\",\n  \"codigoAcademia\": \"{{codigoAcademia}}\"\n}" }
          }
        },
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/api/auth/login" },
            "body": { "mode": "raw", "raw": "{\n  \"email\": \"{{emailProfessor}}\",\n  \"senha\": \"{{senhaProfessor}}\"\n}" }
          },
          "event": [ { "listen": "test", "script": { "exec": [ "pm.test('Status 200', () => pm.response.to.have.status(200));", "try { const json = pm.response.json(); if (json && json.token) pm.collectionVariables.set('token', json.token); } catch(e) {}" ] } } ]
        },
        {
          "name": "Usuário Atual",
          "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/auth/me" } }
        }
      ]
    },
    {
      "name": "Aulas",
      "item": [
        {
          "name": "Minhas Aulas da Semana",
          "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/aulas/minhas/semana" } }
        },
        {
          "name": "Gerar Semana da Turma",
          "request": { "method": "POST", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/aulas/turmas/{{turmaId}}/gerar-semana?timezone={{timezone}}" } }
        },
        {
          "name": "Listar Semana por Turma",
          "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/aulas/turmas/{{turmaId}}/semana" } },
          "event": [ { "listen": "test", "script": { "exec": [ "pm.test('Status 200', () => pm.response.to.have.status(200));", "try { const json = pm.response.json(); const first = Array.isArray(json) ? json[0] : (json.aulas && json.aulas[0]); if (first && first._id) pm.collectionVariables.set('aulaId', first._id); } catch(e) {}" ] } } ]
        },
        {
          "name": "Editar Aula (ex: cancelar)",
          "request": {
            "method": "PATCH",
            "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{token}}" } ],
            "url": { "raw": "{{baseUrl}}/api/aulas/{{aulaId}}" },
            "body": { "mode": "raw", "raw": "{\n  \"status\": \"cancelada\"\n}" }
          }
        }
      ]
    }
  ]
}
