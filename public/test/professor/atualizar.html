<!doctype html><html lang="pt-br"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Professor — Passo 5 (Atualizar)</title><link rel="stylesheet" href="/test/gestor/assets/styles.css"></head><body><button id="theme-toggle" class="theme-toggle btn secondary">Tema</button><div class="wrap"><div class="progress"><div class="step"><div class="dot"></div><span class="muted">Login</span></div><div class="step"><div class="dot"></div><span class="muted">Modalidade</span></div><div class="step"><div class="dot"></div><span class="muted">Faixa & Grau</span></div><div class="step"><div class="dot"></div><span class="muted">Criar</span></div><div class="step"><div class="dot active"></div><span class="muted">Atualizar</span></div></div><div class="card"><h2 class="title">Atualizar Dados do Professor</h2><div class="row"><div><label>Nome<input id="pf-nome"></label><label>Telefone<input id="pf-tel"></label><label>Nascimento<input id="pf-nasc" type="date"></label><label>Foto URL<input id="pf-foto"></label><label>Enviar Foto<input id="pf-file" type="file" accept="image/*"></label></div><div><div class="muted">Opcional: envia/atualiza informações adicionais do perfil.</div><div class="muted">Modalidade/Faixa/Grau serão enviados conforme seleção anterior.</div></div></div><div class="nav"><button class="btn secondary" id="back">Voltar</button><button class="btn" id="save">Salvar</button></div><div id="status" class="status muted"></div></div><div class="card"><pre id="res" class="muted"></pre><div class="nav"><button class="btn" id="finish">Concluir</button></div></div></div><div id="toast" class="toast" style="display:none"></div><script type="module">import{request,applyTheme,toggleTheme,ensureTokenOrRedirect,get,setStatus,toast}from'/test/gestor/assets/api.js';applyTheme();document.getElementById('theme-toggle').onclick=toggleTheme;ensureTokenOrRedirect();(function prefill(){document.getElementById('pf-nome').value=get('prof_nome')||'';document.getElementById('pf-tel').value=get('prof_tel')||'';document.getElementById('pf-nasc').value=get('prof_nasc')||''})();document.getElementById('back').onclick=()=>{location.href='/test/professor/criar.html'};document.getElementById('save').onclick=async()=>{const perfilId=get('prof_perfil_id')||'';if(!perfilId){toast('Crie o professor primeiro');return}const nome=(document.getElementById('pf-nome').value||'').trim();const telefone=(document.getElementById('pf-tel').value||'').trim();const nascimento=(document.getElementById('pf-nasc').value||'').trim();const fotoUrl=(document.getElementById('pf-foto').value||'').trim();const modalidadeId=get('prof_mod')||null;const faixaId=get('prof_faixa')||null;const grauSel=get('prof_grau')||null;let fotoBase64=null;const file=document.getElementById('pf-file').files?.[0]||null;if(file){fotoBase64=await new Promise(resolve=>{const fr=new FileReader();fr.onload=()=>resolve(String(fr.result));fr.readAsDataURL(file)})}const body={};if(nome)body.nome=nome;if(telefone)body.telefone=telefone;if(nascimento)body.nascimento=nascimento;if(fotoUrl)body.fotoUrl=fotoUrl;if(fotoBase64)body.fotoBase64=fotoBase64;if(modalidadeId)body.modalidadeId=modalidadeId;if(faixaId)body.faixaId=faixaId;if(grauSel)body.graus=Number(grauSel);const upd=await request('PATCH','/api/perfis/'+perfilId,body);setStatus(upd.res.ok,'Atualizar: '+upd.res.status);document.getElementById('res').textContent=JSON.stringify(upd.data)};document.getElementById('finish').onclick=()=>{location.href='/test/gestor/checkout'}</script></body></html>