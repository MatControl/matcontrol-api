<!doctype html>
<html lang="pt-br"><head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Modalidades</title>
  <link rel="stylesheet" href="/test/gestor/assets/styles.css">
</head><body>
  <button id="theme-toggle" class="theme-toggle btn secondary">Tema</button>
  <div class="wrap">
    <div class="progress">
      <div class="step"><div class="dot"></div><span class="muted">Cadastro</span></div>
      <div class="step"><div class="dot"></div><span class="muted">Login</span></div>
      <div class="step"><div class="dot"></div><span class="muted">Academia</span></div>
      <div class="step"><div class="dot active"></div><span class="muted">Modalidades</span></div>
      <div class="step"><div class="dot"></div><span class="muted">Planos</span></div>
      <div class="step"><div class="dot"></div><span class="muted">Professor</span></div>
      <div class="step"><div class="dot"></div><span class="muted">Checkout</span></div>
    </div>
    <div class="card">
      <h2 class="title">Modalidades</h2>
      <div class="nav">
        <button class="btn secondary" onclick="location.href='/test/gestor/academia'">Voltar</button>
        <div>
          <button id="listar" class="btn secondary">Listar base</button>
          <button id="ativar" class="btn">Ativar selecionadas</button>
        </div>
      </div>
      <div class="card">
        <div class="muted">IDs base:</div>
        <pre id="base" class="muted"></pre>
        <label>IDs para ativar (v√≠rgulas)<input id="ids"></label>
        <div id="status" class="status muted"></div>
      </div>
      <div class="nav"><button class="btn" onclick="location.href='/test/gestor/planos'">Prosseguir</button></div>
    </div>
  </div>
  <div id="toast" class="toast" style="display:none"></div>
  <script type="module">
    import { request, toast, setStatus, ensureTokenOrRedirect, ensureAcademiaOrRedirect, KEYS, get, applyTheme, toggleTheme, resumeOnPageLoad } from '/test/gestor/assets/api.js'
    applyTheme();
    document.getElementById('theme-toggle').onclick = toggleTheme;
    ensureTokenOrRedirect();
    ensureAcademiaOrRedirect();
    resumeOnPageLoad('/test/gestor/modalidades');
    document.getElementById('listar').onclick = async () => {
      const r = await request('GET','/api/gestor/modalidades/base');
      document.getElementById('base').textContent = (r.data||[]).map(m=>m._id+' '+m.nome).join('\n');
      setStatus(r.res.ok,'Listar: '+r.res.status)
    }
    document.getElementById('ativar').onclick = async () => {
      const raw = document.getElementById('ids').value.trim();
      const modalidades = raw? raw.split(',').map(s=>s.trim()).filter(Boolean) : [];
      const body = { academiaId: get(KEYS.acad), modalidades };
      const r = await request('POST','/api/gestor/modalidades/ativar', body);
      setStatus(r.res.ok,'Ativar: '+r.res.status);
      toast('Modalidades atualizadas')
    }
  </script>
</body></html>