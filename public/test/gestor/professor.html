<!doctype html><html lang="pt-br"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Professor</title><link rel="stylesheet" href="/test/gestor/assets/styles.css"></head><body><button id="theme-toggle" class="theme-toggle btn secondary">Tema</button><div class="wrap"><div class="progress"><div class="step"><div class="dot"></div><span class="muted">Cadastro</span></div><div class="step"><div class="dot"></div><span class="muted">Login</span></div><div class="step"><div class="dot"></div><span class="muted">Academia</span></div><div class="step"><div class="dot"></div><span class="muted">Modalidades</span></div><div class="step"><div class="dot"></div><span class="muted">Planos</span></div><div class="step"><div class="dot active"></div><span class="muted">Professor</span></div><div class="step"><div class="dot"></div><span class="muted">Checkout</span></div></div><div class="card"><h2 class="title">Gestor será Professor?</h2><label><input type="checkbox" id="chk"> Sim</label><div class="row"><div><label>Nome (exibição)<input id="pf-nome"></label><label>Telefone<input id="pf-tel"></label><label>Nascimento<input id="pf-nasc" type="date"></label><label>Modalidade<select id="pf-mod"></select></label><label>Faixa<select id="pf-faixa"></select></label></div><div><label>Foto URL (opcional)<input id="pf-foto"></label><label>Enviar Foto<input id="pf-file" type="file" accept="image/*"></label><div class="muted">Após confirmar, os dados serão salvos no perfil de professor.</div></div></div><div class="nav"><button class="btn secondary" onclick="location.href='/test/gestor/planos'">Voltar</button><button id="submit" class="btn">Confirmar</button></div><div id="status" class="status muted"></div></div><div class="card"><pre id="res" class="muted"></pre><div class="nav"><button class="btn" onclick="location.href='/test/gestor/checkout'">Prosseguir</button></div></div></div><div id="toast" class="toast" style="display:none"></div><script type="module">import{request,toast,setStatus,ensureTokenOrRedirect,applyTheme,toggleTheme,resumeOnPageLoad}from'/test/gestor/assets/api.js';applyTheme();document.getElementById('theme-toggle').onclick=toggleTheme;ensureTokenOrRedirect();resumeOnPageLoad('/test/gestor/professor');async function loadModalidades(){const r=await request('GET','/api/gestor/modalidades/base');const sel=document.getElementById('pf-mod');sel.innerHTML='';(r.data||[]).forEach(m=>{const o=document.createElement('option');o.value=m._id;o.textContent=m.nome;sel.appendChild(o)});if((r.data||[]).length===0){const o=document.createElement('option');o.value='';o.textContent='Sem modalidades';sel.appendChild(o)}}document.getElementById('pf-mod').onchange=async(e)=>{const id=e.target.value;const sel=document.getElementById('pf-faixa');sel.innerHTML='';if(!id){const o=document.createElement('option');o.value='';o.textContent='Selecione modalidade';sel.appendChild(o);return}const rr=await request('GET','/api/niveis/'+id);const list=(rr.data||[]).slice().sort((a,b)=>Number(a.ordem||0)-Number(b.ordem||0)||String(a.nome||'').localeCompare(String(b.nome||'')));if(list.length===0){const o=document.createElement('option');o.value='';o.textContent='Sem faixas';sel.appendChild(o)}else{const p=document.createElement('option');p.value='';p.textContent='Selecione faixa';sel.appendChild(p);list.forEach(n=>{const o=document.createElement('option');o.value=n._id;o.textContent=n.nome;sel.appendChild(o)})}};await loadModalidades();document.getElementById('submit').onclick=async()=>{const go=document.getElementById('chk').checked;if(!go){toast('Marque a opção para prosseguir');return}const r=await request('POST','/api/gestor/professor');setStatus(r.res.ok,'Professor: '+r.res.status);const data=r.data||{};let perfilId=(data?.perfil?._id)||null;perfilId=perfilId||data?.perfil?.id||null;perfilId=perfilId||data?.perfilProfessorId||null;if(!perfilId){toast('Perfil de professor não identificado');document.getElementById('res').textContent=JSON.stringify(data);return}const nome=document.getElementById('pf-nome').value.trim();const telefone=document.getElementById('pf-tel').value.trim();const nascimento=document.getElementById('pf-nasc').value.trim();const fotoUrl=document.getElementById('pf-foto').value.trim();const modalidadeId=document.getElementById('pf-mod').value||null;const faixaId=document.getElementById('pf-faixa').value||null;let fotoBase64=null;const file=document.getElementById('pf-file').files?.[0]||null;if(file){fotoBase64=await new Promise((resolve)=>{const fr=new FileReader();fr.onload=()=>resolve(String(fr.result));fr.readAsDataURL(file)})}const body={};if(nome)body.nome=nome;if(telefone)body.telefone=telefone;if(nascimento)body.nascimento=nascimento;if(fotoUrl)body.fotoUrl=fotoUrl;if(fotoBase64)body.fotoBase64=fotoBase64;if(modalidadeId)body.modalidadeId=modalidadeId;if(faixaId)body.faixaId=faixaId;const upd=await request('PATCH','/api/perfis/'+perfilId,body);document.getElementById('res').textContent=JSON.stringify({criado:data,atualizado:upd.data});if(upd.res.ok){toast('Dados do professor salvos')}};</script></body></html>