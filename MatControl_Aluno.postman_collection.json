{
  "info": {
    "name": "MatControl - Fluxo Aluno (Robusto)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:5000" },
    { "key": "token", "value": "" },
    { "key": "emailAluno", "value": "aluno@example.com" },
    { "key": "senhaAluno", "value": "senha123" },
    { "key": "codigoAcademia", "value": "" },
    { "key": "codigoConvite", "value": "" },
    { "key": "turmaId", "value": "" },
    { "key": "aulaId", "value": "" },
    { "key": "timezone", "value": "America/Sao_Paulo" }
  ],
  "item": [
    {
      "name": "Autenticação",
      "item": [
        { "name": "Registrar Aluno", "request": { "method": "POST", "header": [ { "key": "Content-Type", "value": "application/json" } ], "url": { "raw": "{{baseUrl}}/api/auth/registrar-aluno" }, "body": { "mode": "raw", "raw": "{\n  \"nome\": \"Aluno Exemplo\",\n  \"email\": \"{{emailAluno}}\",\n  \"senha\": \"{{senhaAluno}}\",\n  \"codigoAcademia\": \"{{codigoAcademia}}\"\n}" } } },
        { "name": "Login", "request": { "method": "POST", "header": [ { "key": "Content-Type", "value": "application/json" } ], "url": { "raw": "{{baseUrl}}/api/auth/login" }, "body": { "mode": "raw", "raw": "{\n  \"email\": \"{{emailAluno}}\",\n  \"senha\": \"{{senhaAluno}}\"\n}" } }, "event": [ { "listen": "test", "script": { "exec": [ "pm.test('Status 200', () => pm.response.to.have.status(200));", "try { const json = pm.response.json(); if (json && json.token) pm.collectionVariables.set('token', json.token); } catch(e) {}" ] } } ] },
        { "name": "Usuário Atual", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/auth/me" } } }
      ]
    },
    {
      "name": "Turmas",
      "item": [
        { "name": "Entrar em Turma (código)", "request": { "method": "POST", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/turmas/entrar/{{codigoConvite}}" } }, "event": [ { "listen": "test", "script": { "exec": [ "pm.test('Status 200 ou 201', () => pm.response.code === 200 || pm.response.code === 201);", "try { const json = pm.response.json(); const turma = json.turma || json; if (turma && turma._id) pm.collectionVariables.set('turmaId', turma._id); } catch(e) {}" ] } } ] }
      ]
    },
    {
      "name": "Aulas",
      "item": [
        { "name": "Minhas Aulas da Semana", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/aulas/minhas/semana" } } },
        { "name": "Listar Semana por Turma", "request": { "method": "GET", "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ], "url": { "raw": "{{baseUrl}}/api/aulas/turmas/{{turmaId}}/semana" } }, "event": [ { "listen": "test", "script": { "exec": [ "pm.test('Status 200', () => pm.response.to.have.status(200));", "try { const json = pm.response.json(); const first = Array.isArray(json) ? json[0] : (json.aulas && json.aulas[0]); if (first && first._id) pm.collectionVariables.set('aulaId', first._id); } catch(e) {}" ] } } ] }
      ]
    }
  ]
}
